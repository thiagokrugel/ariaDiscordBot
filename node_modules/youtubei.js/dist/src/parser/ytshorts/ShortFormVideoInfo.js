var _ShortFormVideoInfo_watch_next_continuation;
import { __awaiter, __classPrivateFieldGet, __classPrivateFieldSet } from "tslib";
import { Parser, ContinuationCommand } from '../index.js';
import { InnertubeError } from '../../utils/Utils.js';
import { Reel } from '../../core/endpoints/index.js';
import MediaInfo from '../../core/mixins/MediaInfo.js';
class ShortFormVideoInfo extends MediaInfo {
    constructor(data, actions, cpn, reel_watch_sequence_response) {
        var _a;
        super(data, actions, cpn);
        _ShortFormVideoInfo_watch_next_continuation.set(this, void 0);
        if (reel_watch_sequence_response) {
            const reel_watch_sequence = Parser.parseResponse(reel_watch_sequence_response.data);
            if (reel_watch_sequence.entries)
                this.watch_next_feed = reel_watch_sequence.entries;
            if (reel_watch_sequence.continuation_endpoint)
                __classPrivateFieldSet(this, _ShortFormVideoInfo_watch_next_continuation, (_a = reel_watch_sequence.continuation_endpoint) === null || _a === void 0 ? void 0 : _a.as(ContinuationCommand), "f");
        }
    }
    getWatchNextContinuation() {
        return __awaiter(this, void 0, void 0, function* () {
            var _a;
            if (!__classPrivateFieldGet(this, _ShortFormVideoInfo_watch_next_continuation, "f"))
                throw new InnertubeError('Continuation not found');
            const response = yield this.actions.execute(Reel.ReelWatchSequenceEndpoint.PATH, Object.assign(Object.assign({}, Reel.ReelWatchSequenceEndpoint.build({
                sequence_params: __classPrivateFieldGet(this, _ShortFormVideoInfo_watch_next_continuation, "f").token
            })), { parse: true }));
            if (response.entries)
                this.watch_next_feed = response.entries;
            __classPrivateFieldSet(this, _ShortFormVideoInfo_watch_next_continuation, (_a = response.continuation_endpoint) === null || _a === void 0 ? void 0 : _a.as(ContinuationCommand), "f");
            return this;
        });
    }
    /**
     * Checks if continuation is available for the watch next feed.
     */
    get wn_has_continuation() {
        return !!__classPrivateFieldGet(this, _ShortFormVideoInfo_watch_next_continuation, "f");
    }
}
_ShortFormVideoInfo_watch_next_continuation = new WeakMap();
export default ShortFormVideoInfo;
//# sourceMappingURL=ShortFormVideoInfo.js.map